@page "/forgot-password"
@using Microsoft.AspNetCore.Authorization
@attribute [AllowAnonymous]
@using Microsoft.AspNetCore.Identity
@using FinanceTracker.Models
@inject UserManager<ApplicationUser> UserManager

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6 card p-4 shadow">
            <h4>Passwort vergessen?</h4>
            <p class="text-muted">Gib deine Email an. Dein Admin wird den Reset lokal freischalten.</p>

            <input type="email" class="form-control mb-3" @bind="email" placeholder="Deine Email" />
            <button class="btn btn-primary w-100" @onclick="RequestReset">Reset anfordern</button>

            @if (message != null)
            {
                <div class="alert alert-info mt-3">@message</div>
            }
        </div>
    </div>
</div>

@code {
    private string email = "";
    private string? message;

    private async Task RequestReset()
    {
        var user = await UserManager.FindByEmailAsync(email);
        if (user != null)
        {
            user.IsPasswordResetPending = true;
            await UserManager.UpdateAsync(user);
            message = "Anfrage gesendet. Bitte geh zu deinem Admin, er muss den Reset freischalten.";
        }
    }
}